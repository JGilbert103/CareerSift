<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>CareerSift - Your Job and Internship Finding Website for Charlotte!</title>
        <link rel="stylesheet" type="text/css" href="/static/styles.css">
        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    </head>
    <body>
        <script>
            document.addEventListener("DOMContentLoaded", () => {

                const slider = document.getElementById("sal");
                const amtDisplay = document.getElementById("amt");
                amtDisplay.textContent = "$0";
                slider.addEventListener("input", () => {
                    if (slider.value == 0) {
                        amtDisplay.textContent = "$0";  
                    } else {
                        amtDisplay.textContent = `$0 - $${slider.value}`;
                    }
                });

                const stars = document.querySelectorAll(".star");
                stars.forEach((star) => {
                    star.addEventListener("click", () => {
                        const listid = star.dataset.listid;
                        const isSaved = star.src.includes("star-icon-filled.png");
                        
                        if (star.src.includes("star-icon.png")) {
                            star.src = "/static/star-icon-filled.png";
                        } else {
                            star.src = "/static/star-icon.png";
                        }

                        star.src = isSaved ? "/static/star-icon.png" : "/static/star-icon-filled.png";

                        fetch(isSaved ? '/unsaveListing' : '/saveListing', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ listid: listid }),
                        })
                        .then((response) => {
                            if (!response.ok) {
                                throw new Error('Failed to save or unsave listing.');
                            }
                        })
                        .catch((error) => {
                            console.error(error);
                            star.src = isSaved 
                                ? "/static/star-icon-filled.png" 
                                : "/static/star-icon.png";
                            alert('An error occurred while saving or unsaving the listing.');
                        });
                    });
                });
            });
        </script>
        <div class="nav-back">
            <nav class = "nav-content">
                <a href="index.html"><img src="/static/CS-logo.png" alt="Career-Sift" width="100px" height="66px"></a>
                <ul>
                    <li><a href="{{ url_for('index') }}">Home</a></li>
                    {% if user %}
                    <li><a href="{{ url_for('saved') }}">Saved</a></li> <!-- only if logged in -->
                    {% endif %}
                    <li><a href="{{ url_for('about') }}">About</a></li>
                    <li><a href="{{ url_for('contact') }}">Contact</a></li>
                    {% if user %}
                    <li><a href="{{ url_for('logout') }}"class="but LI">Logout</a></li>
                    {% else %}
                    <li><a href="{{ url_for('login') }}"class="but LI">Log in</a></li> <!-- only if logged out -->
                    {% endif %}
                    <!-- <li><a href="register.html"class="but REG">Register</a></li> maybe if either of these are clicked it goes to their respective one? -->
                    <li><a href="{{ url_for('settings') }}"><img class="contact-chip" src="/static/JakePic.jpg" width="50px" height="50px"></a></li>
                </ul>
            </nav>
            <hr>
        </div>
        <div class="main-container">
            <div class="filters">
                <h3>Refine your Search</h3>
                <hr>
                <h5>Type:</h5>
                <input type="checkbox" id="remote" name="remote"><label for="remote">Remote</label><br>
                <input type="checkbox" id="os" name="os"><label for="os">On-Site</label><br>
                <input type="checkbox" id="hybrid" name="hybrid"><label for="hybrid">Hybrid</label><br>
                <hr>
                <h5>Position:</h5>
                <input type="checkbox" id="FT" name="FT"><label for="FT">Full-Time</label><br>
                <input type="checkbox" id="PT" name="PT"><label for="PT">Part-Time</label><br>
                <input type="checkbox" id="contract" name="contract"><label for="contract">Contract</label><br>
                <hr>
                <h5>Salary:</h5>
                <p class="amt" id="amt"></p>
                <input type="range" id="sal" name="sal" min="0" max="175000" value="0" step="1000"><br>
                <hr>
            </div>
            <div class="search-cards">
                <form action="/" method="GET" class="job-search-bar">
                    <input type="search" name="search" placeholder="Search for jobs..." value="{{ request.args.get('search', '') }}" class="search">
                </form>
                <div class="cards">
                    {% for job in jobs %}
                    <div class="card">
                        {% if user %}
                        {% if job[0] in saved %}
                        <img class="star" src="/static/star-icon-filled.png" data-listid="{{ job[0] }}"> <!--Only if logged in-->
                        {% else %}
                        <img class="star" src="/static/star-icon.png" data-listid="{{ job[0] }}"> <!--Only if logged in-->
                        {% endif %}
                        {% endif %}
                        <br>
                        <a href="{{ url_for('listings', listid=job[0]) }}">
                            <h2>{{ job[1] }}</h2>
                            <p>{{ job[2] }}</p>
                            <hr>
                            <div class="card-info">
                                <p>{{ job[3] }}</p>
                                <p>Location</p>
                                <p>{{ job[5] }}</p>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </body>
</html>

<!--Finished-->